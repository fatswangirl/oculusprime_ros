<?xml version='1.0'?>

<robot name="oculusprime" xmlns:xacro="http://ros.org/wiki/xacro">
<xacro:property name="M_PI" value="3.1415926535897931" /> 
    
	<link name="base_link">
		<inertial>
			<origin xyz="0 0 0.06" rpy="0 0 0" />
			<mass value="4.0"/>
			<inertia ixx="0.0227"
				iyy="0.0359"
				izz="0.0371"
				ixy="0"
				ixz="0"
				iyz="0"	/>
		</inertial>
		
		<collision>
			<origin xyz="-0.0064 0 0.1517" rpy="0 0 0" />
			<geometry>
				<box size=".2818 .19 .2595"/>
			</geometry>
		</collision>

		<visual>
			<origin xyz="0.0127 0 .0808" rpy="0 0 ${M_PI/2}" />
			<geometry>
				<mesh filename="package://oculusprime/description/meshes/chassis.dae" />
			</geometry>
		</visual>
				
	</link>
	
	<material name="black">
		<color rgba="0.1 0.1 0.1 1.0"/>
	</material>
			
	<!-- wheels -->
	<joint type="continuous" name="front_right_wheel_joint">
		<origin xyz="0.0635 -0.1186 0.057" rpy="0 ${M_PI/2} ${M_PI/2}"/>
		<parent link="base_link"/>
		<child link="front_right_wheel_link"/>
		<axis xyz="0 0 1"/>
	</joint>
	
	<link name="front_right_wheel_link">
		<collision>
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<geometry>
				<cylinder radius="0.057" length="0.046" />
			</geometry>
		</collision>
		
		<visual>
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<geometry>
				<cylinder radius="0.057" length="0.046" />
			</geometry>
			<material name="black"/>
		</visual>
		
		<inertial>
			<mass value="0.05" />
			<origin xyz="0 0 0" />
			<inertia ixx="0.001" ixy="0.0" ixz="0.0"
			iyy="0.001" iyz="0.0"
			izz="0.001" />
		</inertial>
	</link>
	
	
	<joint type="continuous" name="front_left_wheel_joint">
		<origin xyz="0.0635 0.1186 0.057" rpy="0 ${M_PI/2} ${M_PI/2}"/>
		<child link="front_left_wheel_link"/>
		<parent link="base_link"/>
		<axis xyz="0 0 1"/>
	</joint>
	
	<link name="front_left_wheel_link">
		<collision>
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<geometry>
				<cylinder radius="0.057" length="0.046" />
			</geometry>
		</collision>
		
		<visual>
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<geometry>
				<cylinder radius="0.057" length="0.046" />
			</geometry>
			<material name="black"/>
		</visual>
		
		<inertial>
			<mass value="0.05" />
			<origin xyz="0 0 0" />
			<inertia ixx="0.001" ixy="0.0" ixz="0.0"
			iyy="0.001" iyz="0.0"
			izz="0.001" />
		</inertial>
	</link>


	<joint type="continuous" name="rear_right_wheel_joint">
		<origin xyz="-0.0635 -0.1186 0.057" rpy="0 ${M_PI/2} ${M_PI/2}"/>
		<child link="rear_right_wheel_link"/>
		<parent link="base_link"/>
		<axis xyz="0 0 1"/>
	</joint>
	
	<link name="rear_right_wheel_link">
		<collision>
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<geometry>
				<cylinder radius="0.057" length="0.046" />
			</geometry>
		</collision>
		
		<visual>
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<geometry>
				<cylinder radius="0.057" length="0.046" />
			</geometry>
			<material name="black"/>
		</visual>
		
		<inertial>
			<mass value="0.05" />
			<origin xyz="0 0 0" />
			<inertia ixx="0.001" ixy="0.0" ixz="0.0"
			iyy="0.001" iyz="0.0"
			izz="0.001" />
		</inertial>
	</link>
	
	
	<joint type="continuous" name="rear_left_wheel_joint">
		<origin xyz="-0.0635 0.1186 0.057" rpy="0 ${M_PI/2} ${M_PI/2}"/>
		<child link="rear_left_wheel_link"/>
		<parent link="base_link"/>
		<axis xyz="0 0 1"/>
	</joint>
	
	<link name="rear_left_wheel_link">
		<collision>
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<geometry>
				<cylinder radius="0.057" length="0.046" />
			</geometry>
		</collision>
		
		<visual>
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<geometry>
				<cylinder radius="0.057" length="0.046" />
			</geometry>
			<material name="black"/>
		</visual>
		
		<inertial>
			<mass value="0.05" />
			<origin xyz="0 0 0" />
			<inertia ixx="0.001" ixy="0.0" ixz="0.0"
			iyy="0.001" iyz="0.0"
			izz="0.001" />
		</inertial>
	</link>
	
	<!-- astra -->
	<xacro:include filename="$(find oculusprime)/description/astra.urdf.xacro"/>
	<sensor_astra parent="base_link"/>
	
	<!-- gazebo specific stuff -->
	<gazebo reference="front_right_wheel_link">
		<mu1>1.0</mu1>
		<mu2>1.0</mu2>
		<kp>1000000.0</kp>
		<kd>100.0</kd>
		<minDepth>0.001</minDepth>
		<maxVel>1.0</maxVel>
		<material>Gazebo/DarkGrey</material>
	</gazebo>

	<gazebo reference="front_left_wheel_link">
		<mu1>1.0</mu1>
		<mu2>1.0</mu2>
		<kp>1000000.0</kp>
		<kd>100.0</kd>
		<minDepth>0.001</minDepth>
		<maxVel>1.0</maxVel>
		<material>Gazebo/DarkGrey</material>
	</gazebo>
	
	<gazebo reference="rear_right_wheel_link">
		<mu1>1.0</mu1>
		<mu2>1.0</mu2>
		<kp>1000000.0</kp>
		<kd>100.0</kd>
		<minDepth>0.001</minDepth>
		<maxVel>1.0</maxVel>
		<material>Gazebo/DarkGrey</material>
	</gazebo>

	<gazebo reference="rear_left_wheel_link">
		<mu1>1.0</mu1>
		<mu2>1.0</mu2>
		<kp>1000000.0</kp>
		<kd>100.0</kd>
		<minDepth>0.001</minDepth>
		<maxVel>1.0</maxVel>
		<material>Gazebo/DarkGrey</material>
	</gazebo>
	
	<joint name="gyro_joint" type="fixed">
      <axis xyz="0 1 0"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <parent link="base_link"/>
      <child link="gyro_link"/>
    </joint>
    <link name="gyro_link">
      <inertial>
        <mass value="0.001"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia ixx="0.0001" ixy="0" ixz="0"
                 iyy="0.000001" iyz="0"
                 izz="0.0001"/>
      </inertial>
    </link>
	
	<gazebo reference="gyro_link">
	   <sensor type="imu" name="imu">
        <always_on>true</always_on>
        <update_rate>50</update_rate>
        <visualize>false</visualize>
        <imu>
          <noise>
            <type>gaussian</type>
	          <rate>
	            <mean>0.0</mean>
	            <stddev>${0.0014*0.0014}</stddev> <!-- 0.25 x 0.25 (deg/s) -->
	            <bias_mean>0.0</bias_mean>
	            <bias_stddev>0.0</bias_stddev>
	          </rate>
		        <accel> <!-- not used in the plugin and real robot, hence using tutorial values -->
			        <mean>0.0</mean>
			        <stddev>1.7e-2</stddev>
			        <bias_mean>0.1</bias_mean>
			        <bias_stddev>0.001</bias_stddev>
		        </accel>
          </noise>
	      </imu>
      </sensor>
	</gazebo>

	<gazebo>
		<plugin name="skidsteer_controller" filename="libgazebo_ros_skid_steer_drive.so">

			<commandTopic>cmd_vel</commandTopic>
			<broadcastTF>true</broadcastTF>
			<odometryTopic>odom</odometryTopic>
			<odometryFrame>odom</odometryFrame>

			<leftFrontJoint>front_left_wheel_joint</leftFrontJoint>
			<rightFrontJoint>front_right_wheel_joint</rightFrontJoint>
			<leftRearJoint>rear_left_wheel_joint</leftRearJoint>
			<rightRearJoint>rear_right_wheel_joint</rightRearJoint>

			<wheelSeparation>0.2372</wheelSeparation>
			<wheelDiameter>0.114</wheelDiameter>

			<torque>1.0</torque>
			<robotBaseFrame>base_link</robotBaseFrame>
			<updateRate>30</updateRate>

		</plugin>
	</gazebo>
	
	<gazebo>
		<plugin name="gazebo_joint_state_publisher" filename="libgazebo_ros_joint_state_publisher.so">
		</plugin>
	</gazebo>
	
</robot>

			
